<#
.SYNOPSIS
    This PowerShell script ensures that Accounts must be configured to require password expiration. Passwords that do not expire increase exposure with a greater probability of being discovered or cracked.

.NOTES
    Author          : Sir William
    LinkedIn        : linkedin.com/in/-----------/
    GitHub          : https://github.com/sirwilliam1
    Date Created    : 2025-09-13
    Last Modified   : 2025-09-13
    Version         : 1.0
    CVEs            : N/A
    Plugin IDs      : N/A
    STIG-ID         : WN10-00-000090

.TESTED ON
    Date(s) Tested  : 
    Tested By       : 
    Systems Tested  : 
    PowerShell Ver. : 

.USAGE
    Put any usage instructions here.
    Example syntax:
    PS C:\> .\STIG-ID-WN10-00-000090.ps29
#>

<#
.SYNOPSIS
    DISA STIG WN10-00-000090 Compliance Check and Remediation

.DESCRIPTION
    - Enumerates all local user accounts.
    - Identifies accounts with "Password never expires" set to True.
    - If any are found, logs them as a finding and clears the flag.
#>

Write-Output "Checking local user accounts for password expiration compliance..."

# Get all local user accounts
$users = Get-LocalUser

foreach ($user in $users) {
    if ($user.Enabled -eq $true) {
        if ($user.PasswordNeverExpires -eq $true) {
            Write-Warning "FINDING: User account '$($user.Name)' is set to 'Password never expires'."

            # Remediation â€“ unset "Password never expires"
            try {
                Set-LocalUser -Name $user.Name -PasswordNeverExpires $false
                Write-Output "Remediated: 'Password never expires' cleared for '$($user.Name)'."
            }
            catch {
                Write-Error "Unable to remediate account '$($user.Name)': $_"
            }
        }
        else {
            Write-Output "PASS: User account '$($user.Name)' requires password expiration."
        }
    }
    else {
        Write-Output "INFO: User account '$($user.Name)' is disabled. Skipping."
    }
}
